{
  "module": {
    "id": "notifications",
    "name": "Notifications & Alerts",
    "category": "core-transversal",
    "version": "1.0.0",
    "status": "production",
    "description": "Real-time in-app notifications system with WebSocket support, notification center, and multi-type event handling"
  },
  "vision": {
    "statement": "Manter usuários engajados e informados através de notificações contextuais, relevantes e em tempo real",
    "principles": [
      "Event-Driven: Notifications generated by system events across all modules",
      "User-Centric: Each user sees only their notifications with proper isolation",
      "Actionable: Every notification has link to related action/entity",
      "Batching: Group similar notifications to reduce noise (future)"
    ]
  },
  "entities": [
    {
      "name": "Notification",
      "table": "Notification",
      "type": "entity",
      "description": "User notification triggered by system events",
      "fields": [
        {"name": "id", "type": "String (CUID)", "pk": true},
        {"name": "userId", "type": "String (UUID)", "fk": "User.id", "indexed": true, "description": "Recipient user ID"},
        {"name": "type", "type": "NotificationType", "indexed": true, "description": "Notification type enum"},
        {"name": "actorId", "type": "String?", "fk": "Profile.id", "description": "Profile who triggered the notification"},
        {"name": "targetId", "type": "String?", "description": "ID of target entity (postId, badgeId, orderId)"},
        {"name": "metadata", "type": "Json?", "description": "Additional data (postTitle, badgeName, orderNumber)"},
        {"name": "read", "type": "Boolean", "default": false, "indexed": true, "description": "Read status"},
        {"name": "createdAt", "type": "DateTime", "default": "now()", "indexed": true}
      ],
      "relations": [
        {"name": "user", "type": "N:1", "target": "User"},
        {"name": "actor", "type": "N:1", "target": "Profile", "nullable": true}
      ],
      "businessRules": [
        "Notifications are immutable (create-only)",
        "Only read flag can be updated",
        "Old notifications (>30 days) cleaned up by scheduled job",
        "User sees only their own notifications",
        "Actor can be null for system notifications"
      ]
    }
  ],
  "valueObjects": [
    {
      "name": "NotificationType",
      "type": "enum",
      "values": ["FOLLOW", "LIKE", "REPOST", "COMMENT", "MENTION", "BADGE", "REPUTATION", "ACHIEVEMENT_UNLOCKED", "GROUP_INVITE", "GROUP_JOIN_REQUEST", "ORDER_UPDATE", "MESSAGE"],
      "descriptions": {
        "FOLLOW": "User started following",
        "LIKE": "Post was liked",
        "COMMENT": "Post was commented",
        "MENTION": "User was mentioned in post",
        "BADGE": "Badge was issued",
        "REPUTATION": "Reputation tier upgraded",
        "ACHIEVEMENT_UNLOCKED": "Achievement unlocked",
        "ORDER_UPDATE": "Order status changed",
        "MESSAGE": "New chat message received"
      }
    }
  ],
  "apis": [
    {"method": "GET", "path": "/api/notifications", "auth": true, "description": "Get notifications list (paginated, filterable by type)"},
    {"method": "PUT", "path": "/api/notifications/:id/read", "auth": true, "description": "Mark notification as read"},
    {"method": "PUT", "path": "/api/notifications/read-all", "auth": true, "description": "Mark all notifications as read"},
    {"method": "DELETE", "path": "/api/notifications/:id", "auth": true, "description": "Delete notification"},
    {"method": "GET", "path": "/api/notifications/unread-count", "auth": true, "description": "Get unread notification count"},
    {"method": "WS", "path": "ws://notifications", "auth": true, "description": "WebSocket channel for real-time notifications"}
  ],
  "useCases": [
    {
      "id": "UC-01",
      "name": "Receive Notification",
      "actors": ["System", "User"],
      "flow": "Event occurs (user followed) → Module emits event → Notification Service creates record → Emits via WebSocket (if online) → User receives real-time → UI shows badge count"
    },
    {
      "id": "UC-02",
      "name": "View Notifications List",
      "actors": ["User"],
      "flow": "Click notification bell → Request GET /api/notifications → Server returns unread + recent read → Display list with icon, actor, message, timestamp, status"
    },
    {
      "id": "UC-03",
      "name": "Mark as Read",
      "actors": ["User"],
      "flow": "Click notification → Send PUT /api/notifications/:id/read → Update read=true → Return updated notification → Remove unread badge"
    },
    {
      "id": "UC-04",
      "name": "Mark All as Read",
      "actors": ["User"],
      "flow": "Click 'Mark all as read' → Send PUT /api/notifications/read-all → Update all unread → Badge count to 0"
    },
    {
      "id": "UC-05",
      "name": "Delete Notification",
      "actors": ["User"],
      "flow": "Swipe/click delete → Send DELETE /api/notifications/:id → Delete record → Remove from list"
    },
    {
      "id": "UC-06",
      "name": "Filter Notifications",
      "actors": ["User"],
      "flow": "Select filter (FOLLOW, LIKE, etc) → Request GET /api/notifications?type=FOLLOW → Return filtered list → Display only selected type"
    }
  ],
  "dependencies": {
    "internal": ["auth", "profile"],
    "external": ["ws (WebSocket)"]
  },
  "security": {
    "authentication": "JWT required for all endpoints",
    "authorization": "Users can only access their own notifications",
    "validation": "Notification type validation, targetId validation",
    "rateLimiting": "GET: 100/min, PUT/DELETE: 50/min"
  },
  "metrics": {
    "key_metrics": [
      {"name": "Notification Delivery Time", "target": "<1s for WebSocket"},
      {"name": "Read Rate", "target": ">60% within 24h"},
      {"name": "Engagement Rate", "target": ">40% click-through"},
      {"name": "Unread Cleanup Rate", "target": "Auto-delete after 30 days"}
    ]
  },
  "futureEnhancements": [
    "Push notifications (PWA)",
    "Email notifications (optional per-user setting)",
    "Notification preferences (per-type enable/disable)",
    "Digest mode (daily summary)",
    "Sound/vibration (mobile)",
    "Notification batching (group similar notifications)"
  ]
}
